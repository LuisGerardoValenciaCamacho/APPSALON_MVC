let pagina=1;const cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};function IniciarApp(){MostrarServicios(),MostrarSeccion(),CambiarSeccion(),PaginaSiguiente(),PaginaAnterior(),BotonesPaginado(),MostrarResumen(),NombreCita(),FechaCita(),DeshabilitarFechaAnterior(),HoraCita()}async function MostrarServicios(){try{const e="http://localhost:3000/api/servicios",t=await fetch(e),a=await t.json(),{servicios:o}=a;o.forEach(e=>{const{id:t,nombre:a,precio:o}=e,n=document.createElement("P");n.textContent=a,n.classList.add("nombre-servicio");const c=document.createElement("P");c.textContent="$ "+o,c.classList.add("precio-servicio");const i=document.createElement("DIV");i.classList.add("servicio"),i.dataset.idServicio=t,i.onclick=SeleccionarServicio,i.appendChild(n),i.appendChild(c),document.querySelector("#servicios").appendChild(i)})}catch(e){console.log(e)}}function Limpiar(){document.querySelector("#nombre").value="",document.querySelector("#fecha").value="",document.querySelector("#hora").value=""}function SeleccionarServicio(e){let t;if(t="P"==e.target.tagName?e.target.parentElement:e.target,t.classList.contains("seleccionado")){t.classList.remove("seleccionado");EliminarServicio(parseInt(t.dataset.idServicio))}else{t.classList.add("seleccionado");AgregarServicio({id:parseInt(t.dataset.idServicio),nombre:t.firstElementChild.textContent,precio:t.firstElementChild.nextElementSibling.textContent})}}function CambiarSeccion(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),pagina=parseInt(e.target.dataset.paso),MostrarSeccion(),BotonesPaginado()})})}function MostrarSeccion(){const e=document.querySelector(".mostrar-seccion");e&&e.classList.remove("mostrar-seccion");document.querySelector("#paso-"+pagina).classList.add("mostrar-seccion");const t=document.querySelector(".tabs .actual");t&&t.classList.remove("actual");document.querySelector(`[data-paso="${pagina}"]`).classList.add("actual")}function PaginaSiguiente(){document.querySelector("#siguiente").addEventListener("click",()=>{pagina++,BotonesPaginado()})}function PaginaAnterior(){document.querySelector("#anterior").addEventListener("click",()=>{pagina--,BotonesPaginado()})}function BotonesPaginado(){const e=document.querySelector("#siguiente"),t=document.querySelector("#anterior");1==pagina?(t.classList.add("ocultar"),e.classList.remove("ocultar")):2==pagina?(t.classList.remove("ocultar"),e.classList.remove("ocultar")):3==pagina&&(e.classList.add("ocultar"),t.classList.remove("ocultar"),Limpiar(),MostrarResumen()),MostrarSeccion()}function MostrarResumen(){const{nombre:e,fecha:t,hora:a,servicios:o}=cita;document.querySelector("#hora").value=cita.hora,document.querySelector("#fecha").value=cita.fecha,document.querySelector("#nombre").value=cita.nombre;const n=document.querySelector(".contenido-resumen");for(;n.firstChild;)n.removeChild(n.firstChild);if(Object.values(cita).includes("")){const e=document.createElement("P");return e.textContent="Falta nombre, fecha, hora o datos de los servicios",e.classList.add("mostrar-mensaje"),void n.appendChild(e)}const c=document.createElement("H2");c.textContent="Resumen",n.appendChild(c);const i=document.createElement("P");i.innerHTML="<span>Nombre:</span> "+e;const r=new Date(t),s=r.getDate()+2,l=r.getMonth(),d=r.getFullYear(),u=a.split(":"),m=u[0]>12?u[0]-12:u[0],p=u[1],v=u[0]>12?"PM":"AM",h=new Date(Date.UTC(d,l,s)).toLocaleDateString("es-MX",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),S=document.createElement("P");S.innerHTML="<span>Fecha:</span> "+h;const f=document.createElement("P");f.innerHTML=`<span>Hora:</span> ${m}:${p} ${v}`,n.appendChild(i),n.appendChild(S),n.appendChild(f);const g=document.createElement("DIV");g.classList.add("resumen-servicios");const L=document.createElement("H3");L.textContent="Resumen de Servicios",g.appendChild(L);let C=0;o.forEach(e=>{const t=document.createElement("DIV");t.classList.add("contenedor-servicio");const a=document.createElement("P");a.textContent=e.nombre;const o=document.createElement("P");o.textContent=e.precio,o.classList.add("precio");const n=e.precio.split("$");C+=parseInt(n[1].trim()),t.appendChild(a),t.appendChild(o),g.appendChild(t)}),n.appendChild(g);const y=document.createElement("P");y.innerHTML="<span>Total a pagar:</span> "+C,y.classList.add("total"),n.appendChild(y);const b=document.createElement("BUTTON");b.textContent="Agendar Cita",b.classList.add("boton-block-derecha"),b.onclick=reservarCita,n.appendChild(b)}async function reservarCita(){const e=cita.servicios.map(e=>e.id),t=new FormData;t.append("id_usuario",cita.id),t.append("fecha",cita.fecha),t.append("hora",cita.hora),t.append("servicios",e);try{const e="http://localhost:3000/api/citas",a=await fetch(e,{method:"POST",body:t});(await a.json()).resultado&&Swal.fire("Cita Creada","Su cita fue creada exitosamente","success").then(()=>{window.location.reload()})}catch(e){Swal.fire({icon:"error",title:"Oops...",text:"Error al crear su cita"})}}function AgregarServicio(e){const{servicios:t}=cita;cita.servicios=[...t,e]}function EliminarServicio(e){const{servicios:t}=cita;cita.servicios=t.filter(t=>t.id!==e)}function NombreCita(){const e=document.querySelector("#nombre");cita.nombre=document.querySelector("#usuario").textContent,cita.id=document.querySelector("#id").value,e.value=cita.nombre,e.classList.add("disable")}function MostrarAlerta(e,t){if(document.querySelector(".alerta"))return;const a=document.createElement("DIV");a.textContent=e,a.classList.add("alerta"),t&&a.classList.add("error");document.querySelector(".formulario").appendChild(a),setTimeout(()=>{a.remove()},3e3)}function FechaCita(){const e=document.querySelector("#fecha");e.addEventListener("input",t=>{const a=new Date(t.target.value).getUTCDay();[0].includes(a)?(t.preventDefault(),e.value="",MostrarAlerta("Domingo no permitido",!0)):cita.fecha=e.value})}function DeshabilitarFechaAnterior(){const e=document.querySelector("#fecha"),t=(new Date).getFullYear();let a=(new Date).getMonth()+1;a<10&&(a="0"+a);const o=`${t}-${a}-${(new Date).getDate()+1}`;e.min=o}function HoraCita(){const e=document.querySelector("#hora");e.addEventListener("input",t=>{const a=t.target.value,o=a.split(":");o[0]<10||o[0]>18?(MostrarAlerta("Horas no validas",!0),setTimeout(()=>{e.value=""},3e3)):cita.hora=a})}function iniciarApp(){path=window.location.pathname,"/admin"==path&&(buscarPorFecha(),bloquearNavegacion()),bloquearNavegacion()}function buscarPorFecha(){document.querySelector("#fechaAdmin").addEventListener("input",e=>{const t=e.target.value;window.location="?fecha="+t})}function bloquearNavegacion(){path=window.location.pathname,console.log(path);const e=document.querySelector("#verCitas"),t=document.querySelector("#verServicios"),a=document.querySelector("#newServicio");"/admin"==path?(e.classList.add("actual"),t.classList.remove("actual"),a.classList.remove("actual")):"/servicios"==path?(t.classList.add("actual"),e.classList.remove("actual"),a.classList.remove("actual")):("/servicios/crear"==path||"/servicios/actualizar"==path)&&(e.classList.remove("actual"),t.classList.remove("actual"),a.classList.add("actual"))}document.addEventListener("DOMContentLoaded",(function(){Limpiar(),IniciarApp()})),document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));
//# sourceMappingURL=bundle.js.map
